$(document).ready(function(){if(typeof(cookie)=="object"&&typeof(cookie.init)=="function"){cookie.init();}userModule.init();backend.init();});var userModule=(function(){var a={name:"auiz"};
init=function(){$.get("/admin/getProfile",{},function(b){setProfile(b);},"json");};setProfile=function(b){a=b;modal=$("#modal-confirm-delete");table=modal.find(".modal-header").data("table");
a.currentPage=table;return a;};getProfile=function(){return a;};return{getProfile:getProfile,init:init};})(jQuery);var backend={init:function(){var a=this;
a.initParam();a.initTree();a.initLayout();a.initForm();a.initSave();a.initDelete();a.initEdit();a.initActive();},initParam:function(){var a=this;a.baseUrl=$("body").data("base-url");
},initLayout:function(){$("#formLayout").on("click","#btn-add-row",function(h){h.preventDefault();var f=$("[name=select-layout]:checked").val(),g=f.split("-"),c="",b="",i=$(".row-content").size()?($(".row-content:last").data("index")+1):0,a="data[content]["+i+"]",d="{height: 200}";
textEditor='<textarea ui-jp="summernote" ui-options="'+d+'" class="form-control" rows="4" name="'+a+'[content][]"></textarea>';deleteRow='<i class="material-icons md-24 text-danger delete-layout">ÓÖù</i>';
$.each(g,function(j,e){b+='<input type="hidden" name="'+a+'[config][]" value="'+e+'">';c+='<div class="col-md-'+e+'">';if(j==0){c+=deleteRow;}c+='<div class="box p-a">'+textEditor+"</div></div>";
});c='<div class="row form-group row-content" data-index="'+i+'">'+c+b+"</div>";$(".layout-builder").append(c);$(".delete-layout").css("position","absolute").css("margin-left","-24px").css("margin-top","0%").css("cursor","pointer");
$(".delete-layout").closest("div").css("padding-left","24px");if($(".row-content").size()>=3){$("#add-layout").addClass("hide");}$("[ui-jp]").uiJp();}).on("show.bs.modal",function(a){$(this).css("top","-580px");
});$("#form-layout").on("click",".delete-layout",function(a){a.preventDefault();$(this).closest("div.row.row-content").remove();$("#add-layout").removeClass("hide");
});},initEdit:function(){$("[id=btn-edit]").on("click",function(a){a.preventDefault();url=$(this).data("target");window.location.href=url;});},initDelete:function(){var a=this;
$("body").on("click.deletePopup","[id='btn-delete']",function(b){b.preventDefault();rowId=$(this).closest("tr").data("id");modal=$("#modal-confirm-delete");
if(modal.size()){msg=modal.find(".modal-body").data("confirm")+rowId+"?";modal.find(".modal-body").empty().append(msg);modal.find(".modal-header").data("id",rowId);
modal.modal("show");}}).on("click.confirmDelete","[id='btn-confirm-delete']",function(b){b.preventDefault();modal=$("#modal-confirm-delete");rowId=modal.find(".modal-header").data("id");
table=modal.find(".modal-header").data("table");flag=modal.find(".modal-header").data("flag");if(table&&rowId){var c={table:table,id:rowId};if(flag!=undefined){c.flag=flag;
}$.post(a.baseUrl+"api/delete",c,function(d){if(d.success){$.notify(d.message,{type:"success",allow_dismiss:false,animate:{enter:"animated bounceInDown",exit:"animated bounceOutUp"}});
}else{$.notify(d.message,{type:"danger",allow_dismiss:false,animate:{enter:"animated bounceInDown",exit:"animated bounceOutUp"}});}if(flag!=undefined){$("."+d.flag+"-"+d.id).remove();
modal.modal("hide");}else{setTimeout(function(){window.location.reload(1);},1000);}},"json");}else{$.notify(modal.find(".modal-footer").data("error"),{type:"danger",allow_dismiss:false});
modal.modal("hide");}}).on("click.deletePDF",".delete-pdf",function(d){d.preventDefault();var c=$(this).data("id"),b=$("#modal-confirm-delete");if(b.size()){msg=b.find(".modal-body").data("pdf");
b.find(".modal-body").empty().append(msg);b.find(".modal-header").data("id",c).data("flag","pdf");b.modal("show");}});},initSave:function(){$("#btn-save-form").on("click",function(a){a.preventDefault();
if($("#page-map-manu").size()){backend.saveMapMenu();}if($("#form-update-profile").size()){$("#form-update-profile").trigger("submit");}});},initForm:function(){var a=this;
$("#embed-form").on("submit",function(c,b){if(b==undefined){c.preventDefault();text=$("textarea").val();$("textarea").val(b64EncodeUnicode(text));$(c.currentTarget).trigger(c.type,{encoded:true});
}});$("form.embed").on("submit",function(c,b){if(b==undefined){c.preventDefault();var d=$("#inputDetail").val();$(this).summernote("code",b64EncodeUnicode(d));
}});},initTree:function(){var a=this;$("#gtreetable").gtreetable({draggable:false,types:{"default":"glyphicon glyphicon-folder-open"},manyroots:true,cache:2,language:"th-TH",showExpandIconOnEmpty:true,source:function(b){return{type:"POST",url:a.baseUrl+"api/nodeMenu",data:{id:b,level:$(".node[data-id="+b+"]:first").data("level")},dataType:"json",error:function(c){alert(c.status+": "+c.responseText);
}};},onSave:function(b){return{type:"POST",url:!b.isSaved()?a.baseUrl+"api/nodeCreate":a.baseUrl+"api/nodeUpdate?id="+b.getId(),data:{parent:b.getParent(),name:b.getName(),position:b.getInsertPosition(),related:b.getRelatedNodeId()},dataType:"json",error:function(c){alert(c.status+": "+c.responseText);
}};},onDelete:function(b){if(b.getId()==0){return false;}return{type:"POST",url:a.baseUrl+"api/nodeDelete",dataType:"json",data:{id:b.getId()},error:function(c){alert(c.status+": "+c.responseText);
}};},onMove:function(c,d,b){return{type:"POST",url:a.baseUrl+"api/nodeMove",data:{id:c.getId(),related:d.getId(),position:b},dataType:"json",error:function(e){alert(e.status+": "+e.responseText);
}};}});$(".tree").treegrid({expanderExpandedClass:"glyphicon glyphicon-minus",expanderCollapsedClass:"glyphicon glyphicon-plus",indentTemplate:'<span class="treegrid-indent"></span>'});
},saveMapMenu:function(){var a=this;var b=$("select,input:text,input:number").filter(function(){return $(this).attr("data-default")!=$(this).val();});if(b.length){params=b.serializeArray();
$.post(a.baseUrl+"main/update-menu",params,function(c){if(c.success){var d=$.notify(c.message,{type:"success",allow_dismiss:false});}else{var d=$.notify(c.message,{type:"danger",allow_dismiss:false});
}},"json");}},updateProfile:function(){var a=this;var b=$("#form-update-profile").serializeArray();$.post(a.baseUrl+"user/update-profile",b,function(c){if(c.success){var d=$.notify(c.message,{type:"success",allow_dismiss:false});
$("[name*=password").val("");}else{var d=$.notify(c.message,{type:"danger",allow_dismiss:false});$("[name*=old_password").val("");}},"json");},initActive:function(){$("a.active-status").on("click",function(a){a.preventDefault();
icon=$(this);rowTr=$(this).closest("tr");id=rowTr.data("id");profile=userModule.getProfile();if(profile.currentPage&&profile.role[profile.currentPage+"_publish"]!="on"&&!profile.isAdmin){return false;
}else{$.post("/admin/publish/",{table:profile.currentPage,id:id},function(b){icon.toggleClass("active");},"json");}return false;});},};function b64EncodeUnicode(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,function(b,c){return String.fromCharCode("0x"+c);
}));}function b64DecodeUnicode(a){return decodeURIComponent(Array.prototype.map.call(atob(a),function(b){return"%"+("00"+b.charCodeAt(0).toString(16)).slice(-2);
}).join(""));}